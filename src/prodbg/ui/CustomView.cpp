#include "CustomView.h"
#include <PDUI.h>
#include <QPainter>
#include <QPaintEvent>

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

namespace prodbg
{

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

CustomView::CustomView(QWidget* parent, void* userData, PDCustomDrawCallback callback) : 
	QWidget(parent),
	m_userData(userData),
	m_callback(callback)
{
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void fill_rect(void* privateData, PDRect* rect, unsigned int color)
{
	QPainter* painter = (QPainter*)privateData;
	QRect qRect(QPoint(rect->x, rect->y), QPoint(rect->width, rect->height));
	painter->fillRect(qRect, color);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void initPainter(PDUIPainter* pdPainter, QPainter* qPainter)
{
	pdPainter->privateData = (void*)qPainter;
	pdPainter->fill_rect = fill_rect;
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void CustomView::paintEvent(QPaintEvent* event)
{
	PDUIPainter pdPainter;
	QPainter qPainter(this); 
	QRect qRect = event->rect();
	PDRect rect = { qRect.x(), qRect.y(), qRect.width(), qRect.height() };

	pdPainter.privateData = &qPainter;
	pdPainter.fill_rect = fill_rect;

	m_callback(m_userData, &rect, &pdPainter);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}
